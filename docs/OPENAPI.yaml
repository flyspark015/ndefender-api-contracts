openapi: 3.0.3
info:
  title: N-Defender Unified APIs
  version: 1.0.0
  description: |
    OpenAPI specification for N-Defender Backend Aggregator (primary),
    System Controller, and Observability APIs. Some endpoints (WS) are
    documented as notes due to protocol constraints.
servers:
  - url: http://127.0.0.1:8001/api/v1
    description: Backend Aggregator (default)
  - url: http://127.0.0.1:8002/api/v1
    description: System Controller (default)
  - url: http://127.0.0.1:8890/api/v1
    description: AntSDR Scan (default)
security: []

components:
  securitySchemes: {}
  schemas:
    ErrorDetail:
      type: object
      properties:
        detail:
          type: string

    StatusSnapshot:
      $ref: ../schemas/StatusSnapshot.json

    Contact:
      $ref: ../schemas/Contact.json

    EventEnvelope:
      $ref: ../schemas/EventEnvelope.json

    CommandResult:
      type: object
      required: [command, command_id, accepted, timestamp_ms]
      additionalProperties: false
      properties:
        command: { type: string }
        command_id: { type: string }
        accepted: { type: boolean }
        detail: { type: string, nullable: true }
        timestamp_ms: { type: integer, minimum: 0 }

    SystemStats:
      $ref: ../schemas/SystemStats.json

    UpsTelemetry:
      $ref: ../schemas/UPS_Telemetry.json

    ServiceStatus:
      type: object
      additionalProperties: false
      required: [name, active_state, sub_state, restart_count]
      properties:
        name: { type: string }
        active_state: { type: string }
        sub_state: { type: string }
        restart_count: { type: integer }

    NetworkStatus:
      type: object
      additionalProperties: false
      properties:
        connected: { type: boolean }
        ssid: { type: string }
        ip_v4: { type: string }
        ip_v6: { type: string }
        wifi: { $ref: ../schemas/WifiState.json }
        bluetooth: { $ref: ../schemas/BluetoothState.json }

    AudioStatus:
      $ref: ../schemas/AudioState.json

    WifiState:
      $ref: ../schemas/WifiState.json
    WifiScanResult:
      $ref: ../schemas/WifiScanResult.json
    BluetoothState:
      $ref: ../schemas/BluetoothState.json
    BluetoothDeviceList:
      $ref: ../schemas/BluetoothDeviceList.json
    GPSState:
      $ref: ../schemas/GPSState.json
    ESP32State:
      $ref: ../schemas/ESP32State.json
    ESP32Config:
      $ref: ../schemas/ESP32Config.json
    AntSDRDeviceState:
      $ref: ../schemas/AntSDRDeviceState.json
    AntSDRSweepState:
      $ref: ../schemas/AntSDRSweepState.json
    AntSDRGainState:
      $ref: ../schemas/AntSDRGainState.json
    AntSDRStats:
      $ref: ../schemas/AntSDRStats.json
    RemoteIDState:
      $ref: ../schemas/RemoteIDState.json
    RemoteIDStats:
      $ref: ../schemas/RemoteIDStats.json
    RemoteIDReplayState:
      $ref: ../schemas/RemoteIDReplayState.json

    HealthResponse:
      type: object
      properties:
        status: { type: string }
        timestamp_ms: { type: integer }

    SystemControllerHealth:
      type: object
      required: [ok, timestamp_ms, version]
      properties:
        ok: { type: boolean }
        timestamp_ms: { type: integer }
        version: { type: string }
    RFScanHealth:
      type: object
      properties:
        status: { type: string }
        engine_running: { type: boolean }
        ws_backend_connected: { type: boolean }
        last_event_timestamp_ms: { type: integer, nullable: true }
        timestamp_ms: { type: integer }

    SystemControllerSnapshot:
      type: object
      required: [timestamp_ms]
      properties:
        timestamp_ms: { type: integer }
        system: { $ref: "#/components/schemas/SystemStats" }
        ups: { $ref: "#/components/schemas/UpsTelemetry" }
        services: { type: array, items: { $ref: "#/components/schemas/ServiceStatus" } }
        network: { $ref: "#/components/schemas/NetworkStatus" }
        gps: { $ref: "#/components/schemas/GPSState" }
        audio: { $ref: "#/components/schemas/AudioStatus" }

    ObservabilityStatus:
      type: object
      properties:
        generated_ts: { type: integer }
        overall_state: { type: string }
        state_counts: { type: object, additionalProperties: { type: integer } }
        subsystems:
          type: array
          items:
            type: object
            properties:
              subsystem: { type: string }
              state: { type: string }
              last_update_age_ms: { type: integer, nullable: true }
              last_error_ts: { type: integer, nullable: true }

    ObservabilityHealthDetail:
      type: object
      properties:
        generated_ts: { type: integer }
        subsystems:
          type: array
          items:
            type: object
            properties:
              subsystem: { type: string }
              state: { type: string }
              updated_ts: { type: integer, nullable: true }
              last_error: { type: string, nullable: true }
              last_error_ts: { type: integer, nullable: true }
              last_response_ago_ms: { type: integer, nullable: true }
              reasons: { type: array, items: { type: string } }
              evidence: { type: object }
        status: { type: string }

paths:
  /health:
    get:
      summary: Backend Aggregator health
      tags: [Aggregator]
      responses:
        "200":
          description: Health ok
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/HealthResponse"
                  - $ref: "#/components/schemas/SystemControllerHealth"
                  - $ref: "#/components/schemas/RFScanHealth"
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /status:
    get:
      summary: Backend Aggregator status snapshot
      tags: [Aggregator]
      responses:
        "200":
          description: Status snapshot
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/StatusSnapshot"
                  - $ref: "#/components/schemas/SystemControllerSnapshot"
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /contacts:
    get:
      summary: Backend Aggregator contacts list
      tags: [Aggregator]
      responses:
        "200":
          description: Contacts
          content:
            application/json:
              schema:
                type: object
                properties:
                  contacts:
                    type: array
                    items: { $ref: "#/components/schemas/Contact" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /system:
    get:
      summary: Backend Aggregator system view
      tags: [Aggregator]
      responses:
        "200":
          description: System stats
          content:
            application/json:
              schema: { $ref: "#/components/schemas/SystemStats" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /power:
    get:
      summary: Backend Aggregator UPS telemetry
      tags: [Aggregator]
      responses:
        "200":
          description: UPS telemetry
          content:
            application/json:
              schema: { $ref: "#/components/schemas/UpsTelemetry" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /rf:
    get:
      summary: Backend Aggregator RF state
      tags: [Aggregator]
      responses:
        "200":
          description: RF ingest state
          content:
            application/json:
              schema:
                type: object
                properties:
                  last_event_type: { type: string }
                  last_event: { type: object }
                  last_timestamp_ms: { type: integer }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /video:
    get:
      summary: Backend Aggregator video state
      tags: [Aggregator]
      responses:
        "200":
          description: Video state
          content:
            application/json:
              schema:
                type: object
                properties:
                  selected: { type: integer }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /services:
    get:
      summary: Backend Aggregator services
      tags: [Aggregator]
      responses:
        "200":
          description: Service list
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/ServiceStatus" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /network:
    get:
      summary: Backend Aggregator network state
      tags: [Aggregator]
      responses:
        "200":
          description: Network status
          content:
            application/json:
              schema: { $ref: "#/components/schemas/NetworkStatus" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /audio:
    get:
      summary: Backend Aggregator audio state
      tags: [Aggregator]
      responses:
        "200":
          description: Audio status
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AudioStatus" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /network/wifi/state:
    get:
      summary: Backend Aggregator Wi-Fi state
      tags: [Aggregator]
      responses:
        "200":
          description: Wi-Fi state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/WifiState" }

  /network/wifi/scan:
    get:
      summary: Backend Aggregator Wi-Fi scan
      tags: [Aggregator]
      responses:
        "200":
          description: Wi-Fi scan results
          content:
            application/json:
              schema: { $ref: "#/components/schemas/WifiScanResult" }

  /network/bluetooth/state:
    get:
      summary: Backend Aggregator Bluetooth state
      tags: [Aggregator]
      responses:
        "200":
          description: Bluetooth state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BluetoothState" }

  /network/bluetooth/devices:
    get:
      summary: Backend Aggregator Bluetooth devices
      tags: [Aggregator]
      responses:
        "200":
          description: Bluetooth devices
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BluetoothDeviceList" }

  /gps:
    get:
      summary: Backend Aggregator GPS state
      tags: [Aggregator]
      responses:
        "200":
          description: GPS state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/GPSState" }

  /esp32:
    get:
      summary: Backend Aggregator ESP32 state
      tags: [Aggregator]
      responses:
        "200":
          description: ESP32 state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ESP32State" }

  /esp32/config:
    get:
      summary: Backend Aggregator ESP32 config
      tags: [Aggregator]
      responses:
        "200":
          description: ESP32 config
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ESP32Config" }
    post:
      summary: Backend Aggregator write ESP32 config
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    config: { type: object }
                confirm: { type: boolean }
      responses:
        "200":
          description: Command result
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CommandResult" }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /antsdr:
    get:
      summary: Backend Aggregator AntSDR summary
      tags: [Aggregator]
      responses:
        "200":
          description: AntSDR device state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRDeviceState" }

  /antsdr/sweep/state:
    get:
      summary: Backend Aggregator AntSDR sweep state
      tags: [Aggregator]
      responses:
        "200":
          description: AntSDR sweep state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRSweepState" }

  /antsdr/gain:
    get:
      summary: Backend Aggregator AntSDR gain state
      tags: [Aggregator]
      responses:
        "200":
          description: AntSDR gain state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRGainState" }

  /antsdr/stats:
    get:
      summary: Backend Aggregator AntSDR stats
      tags: [Aggregator]
      responses:
        "200":
          description: AntSDR stats
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRStats" }

  /remote_id:
    get:
      summary: Backend Aggregator RemoteID summary
      tags: [Aggregator]
      responses:
        "200":
          description: RemoteID state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RemoteIDState" }

  /remote_id/contacts:
    get:
      summary: Backend Aggregator RemoteID contacts
      tags: [Aggregator]
      responses:
        "200":
          description: Contact list
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp_ms: { type: integer }
                  contacts:
                    type: array
                    items: { $ref: "#/components/schemas/Contact" }

  /remote_id/stats:
    get:
      summary: Backend Aggregator RemoteID stats
      tags: [Aggregator]
      responses:
        "200":
          description: RemoteID stats
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RemoteIDStats" }

  /audio/mute:
    post:
      summary: Mute/unmute audio
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    muted: { type: boolean }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /audio/volume:
    post:
      summary: Set audio volume
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    volume_percent: { type: integer }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/wifi/enable:
    post:
      summary: Enable or disable Wi-Fi
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    enabled: { type: boolean }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/wifi/disable:
    post:
      summary: Disable Wi-Fi
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/wifi/connect:
    post:
      summary: Connect to Wi-Fi
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    ssid: { type: string }
                    password: { type: string }
                    hidden: { type: boolean }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/wifi/disconnect:
    post:
      summary: Disconnect Wi-Fi
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/bluetooth/enable:
    post:
      summary: Enable or disable Bluetooth
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    enabled: { type: boolean }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/bluetooth/disable:
    post:
      summary: Disable Bluetooth
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/bluetooth/scan/start:
    post:
      summary: Start Bluetooth scan
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/bluetooth/scan/stop:
    post:
      summary: Stop Bluetooth scan
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/bluetooth/pair:
    post:
      summary: Pair Bluetooth device
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    addr: { type: string }
                    pin: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /network/bluetooth/unpair:
    post:
      summary: Unpair Bluetooth device
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    addr: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /gps/restart:
    post:
      summary: Restart GPS service
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: confirm required, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /esp32/buzzer:
    post:
      summary: ESP32 buzzer control
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    mode: { type: string }
                    duration_ms: { type: integer }
                    pattern: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /esp32/leds:
    post:
      summary: ESP32 LED control
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    red: { type: boolean }
                    yellow: { type: boolean }
                    green: { type: boolean }
                    pattern: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /esp32/buttons/simulate:
    post:
      summary: Simulate ESP32 button press (local-only)
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    button: { type: string }
                    action: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: local only, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /antsdr/sweep/start:
    post:
      summary: Start AntSDR sweep
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    plan: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /antsdr/sweep/stop:
    post:
      summary: Stop AntSDR sweep
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /antsdr/gain/set:
    post:
      summary: Set AntSDR gain
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    mode: { type: string }
                    gain_db: { type: number }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /antsdr/device/reset:
    post:
      summary: Reset AntSDR device (dangerous)
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: confirm required, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /remote_id/monitor/start:
    post:
      summary: Start RemoteID capture
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /remote_id/monitor/stop:
    post:
      summary: Stop RemoteID capture
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "400": { description: bad request, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "409": { description: invalid state, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }
        "429": { description: rate limited, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /vrx/tune:
    post:
      summary: Tune VRX frequency
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    vrx_id: { type: integer }
                    freq_hz: { type: integer }
                confirm: { type: boolean }
      responses:
        "200":
          description: Command result
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CommandResult" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /scan/start:
    post:
      summary: Start VRX scan
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    dwell_ms: { type: integer }
                    step_hz: { type: integer }
                    start_hz: { type: integer }
                    stop_hz: { type: integer }
                confirm: { type: boolean }
      responses:
        "200":
          description: Command result
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CommandResult" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /scan/stop:
    post:
      summary: Stop VRX scan
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200":
          description: Command result
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CommandResult" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /video/select:
    post:
      summary: Select video channel
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    ch: { type: integer }
                confirm: { type: boolean }
      responses:
        "200":
          description: Command result
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CommandResult" }
        "401":
          description: Invalid API key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: RBAC forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /system/reboot:
    post:
      summary: Reboot system (dangerous)
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [confirm]
              properties:
                confirm: { type: boolean }
      responses:
        "200":
          description: Command result
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CommandResult" }
        "400":
          description: confirm required
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: Unsafe operations disabled
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /system/shutdown:
    post:
      summary: Shutdown system (dangerous)
      tags: [Aggregator]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [confirm]
              properties:
                confirm: { type: boolean }
      responses:
        "200":
          description: Command result
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CommandResult" }
        "400":
          description: confirm required
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: Unsafe operations disabled
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /ws:
    get:
      summary: Backend Aggregator WebSocket (documented in markdown)
      tags: [Aggregator]
      description: |
        WebSocket fast path. See docs/WEBSOCKET_EVENTS.md for full envelope and events.
      responses:
        "101":
          description: Switching Protocols

  # -----------------------
  # System Controller API (non-overlapping paths)
  # -----------------------

  /ups:
    get:
      summary: System Controller UPS
      tags: [System Controller]
      servers:
        - url: http://127.0.0.1:8002/api/v1
      responses:
        "200":
          description: UPS telemetry
          content:
            application/json:
              schema: { $ref: "#/components/schemas/UpsTelemetry" }

  /services/{name}/restart:
    post:
      summary: Restart a service
      tags: [System Controller]
      servers:
        - url: http://127.0.0.1:8002/api/v1
      parameters:
        - name: name
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200":
          description: Command ACK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EventEnvelope" }
        "400":
          description: confirm required
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: cooldown active
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "403":
          description: unsafe disabled
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  # -----------------------
  # Observability API
  # -----------------------

  /observability/health:
    get:
      summary: Observability health
      tags: [Observability]
      servers:
        - url: http://127.0.0.1:9109/api/v1
      responses:
        "200":
          description: Health ok
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string }

  /observability/health/detail:
    get:
      summary: Observability health detail
      tags: [Observability]
      servers:
        - url: http://127.0.0.1:9109/api/v1
      responses:
        "200":
          description: Health detail
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ObservabilityHealthDetail" }

  /observability/status:
    get:
      summary: Observability status
      tags: [Observability]
      servers:
        - url: http://127.0.0.1:9109/api/v1
      responses:
        "200":
          description: Status snapshot
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ObservabilityStatus" }

  /observability/version:
    get:
      summary: Observability version
      tags: [Observability]
      servers:
        - url: http://127.0.0.1:9109/api/v1
      responses:
        "200":
          description: Version
          content:
            application/json:
              schema:
                type: object
                properties:
                  version: { type: string }
                  git_sha: { type: string }

  /observability/config:
    get:
      summary: Observability config (sanitized)
      tags: [Observability]
      servers:
        - url: http://127.0.0.1:9109/api/v1
      responses:
        "200":
          description: Config
          content:
            application/json:
              schema:
                type: object

  /observability/diag/bundle:
    post:
      summary: Observability diagnostics bundle
      tags: [Observability]
      servers:
        - url: http://127.0.0.1:9109/api/v1
      responses:
        "200":
          description: Bundle result
          content:
            application/json:
              schema:
                type: object
                properties:
                  path: { type: string }
                  size_bytes: { type: integer }
                  created_ts: { type: integer }
        "403":
          description: local only
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "429":
          description: cooldown active
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }
        "500":
          description: bundle generation failure
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  # -----------------------
  # AntSDR Scan Local API
  # -----------------------

  /version:
    get:
      summary: AntSDR Scan version
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      responses:
        "200":
          description: Version
          content:
            application/json:
              schema: { type: object }

  /stats:
    get:
      summary: AntSDR Scan stats
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      responses:
        "200":
          description: Stats
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRStats" }

  /device:
    get:
      summary: AntSDR device state
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      responses:
        "200":
          description: Device state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRDeviceState" }

  /sweep/state:
    get:
      summary: AntSDR sweep state
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      responses:
        "200":
          description: Sweep state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRSweepState" }

  /gain:
    get:
      summary: AntSDR gain state
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      responses:
        "200":
          description: Gain state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AntSDRGainState" }

  /config:
    get:
      summary: AntSDR config
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      responses:
        "200":
          description: Config
          content:
            application/json:
              schema: { type: object }

  /config/reload:
    post:
      summary: AntSDR config reload
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      responses:
        "200":
          description: Reload ok
          content:
            application/json:
              schema: { type: object }
        "409":
          description: conflict
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorDetail" }

  /sweep/start:
    post:
      summary: AntSDR sweep start
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    plan: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "409": { description: conflict, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /sweep/stop:
    post:
      summary: AntSDR sweep stop
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "409": { description: conflict, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /gain/set:
    post:
      summary: AntSDR set gain
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    mode: { type: string }
                    gain_db: { type: number }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "409": { description: conflict, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /device/reset:
    post:
      summary: AntSDR device reset (dangerous)
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /device/calibrate:
    post:
      summary: AntSDR device calibrate (dangerous)
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    kind: { type: string }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
        "403": { description: unsafe disabled, content: { application/json: { schema: { $ref: "#/components/schemas/ErrorDetail" } } } }

  /events/last:
    get:
      summary: AntSDR recent events
      tags: [AntSDR Scan]
      servers:
        - url: http://127.0.0.1:8890/api/v1
      parameters:
        - name: limit
          in: query
          schema: { type: integer }
      responses:
        "200":
          description: Events list
          content:
            application/json:
              schema: { type: object }

  # -----------------------
  # RemoteID Engine Local API
  # -----------------------

  /remoteid-engine/status:
    get:
      summary: RemoteID status
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      responses:
        "200":
          description: Status
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RemoteIDState" }

  /remoteid-engine/health:
    get:
      summary: RemoteID health
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      responses:
        "200":
          description: Health
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RemoteIDState" }

  /remoteid-engine/contacts:
    get:
      summary: RemoteID contacts
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      responses:
        "200":
          description: Contact list
          content:
            application/json:
              schema:
                type: object
                properties:
                  timestamp_ms: { type: integer }
                  contacts:
                    type: array
                    items: { $ref: "#/components/schemas/Contact" }

  /remoteid-engine/stats:
    get:
      summary: RemoteID stats
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      responses:
        "200":
          description: Stats
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RemoteIDStats" }

  /remoteid-engine/replay/state:
    get:
      summary: RemoteID replay state
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      responses:
        "200":
          description: Replay state
          content:
            application/json:
              schema: { $ref: "#/components/schemas/RemoteIDReplayState" }

  /remoteid-engine/replay/start:
    post:
      summary: Start replay
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
                  properties:
                    source: { type: string }
                    interval_ms: { type: integer }
                    loop: { type: boolean }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }

  /remoteid-engine/replay/stop:
    post:
      summary: Stop replay
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }

  /remoteid-engine/monitor/start:
    post:
      summary: Start RemoteID capture
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }

  /remoteid-engine/monitor/stop:
    post:
      summary: Stop RemoteID capture
      tags: [RemoteID Engine]
      servers:
        - url: http://127.0.0.1:9001/api/v1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload: { type: object }
                confirm: { type: boolean }
      responses:
        "200": { description: Command result, content: { application/json: { schema: { $ref: "#/components/schemas/CommandResult" } } } }
