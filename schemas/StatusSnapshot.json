{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "StatusSnapshot.json",
  "title": "Backend Aggregator StatusSnapshot",
  "type": "object",
  "additionalProperties": false,
  "required": ["timestamp_ms"],
  "properties": {
    "timestamp_ms": {"type": "integer", "minimum": 0},
    "system": {"$ref": "#/$defs/system_stats"},
    "power": {"$ref": "./UPS_Telemetry.json"},
    "rf": {"$ref": "#/$defs/ingest_state"},
    "remote_id": {"$ref": "#/$defs/ingest_state"},
    "vrx": {"$ref": "#/$defs/vrx_state"},
    "video": {"$ref": "#/$defs/video_state"},
    "services": {"type": "array", "items": {"$ref": "#/$defs/service_status"}},
    "network": {"$ref": "#/$defs/network_status"},
    "audio": {"$ref": "#/$defs/audio_status"},
    "contacts": {"type": "array", "items": {"$ref": "./Contact.json"}},
    "replay": {"$ref": "#/$defs/replay_state"}
  },
  "$defs": {
    "system_stats": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "uptime_s": {"type": "integer"},
        "cpu_temp_c": {"type": "number"},
        "cpu_usage_percent": {"type": "number"},
        "load_1m": {"type": "number"},
        "load_5m": {"type": "number"},
        "load_15m": {"type": "number"},
        "ram_used_mb": {"type": "integer"},
        "ram_total_mb": {"type": "integer"},
        "disk_used_gb": {"type": "integer"},
        "disk_total_gb": {"type": "integer"},
        "throttled_flags": {"type": "integer"}
      }
    },
    "service_status": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "active_state", "sub_state", "restart_count"],
      "properties": {
        "name": {"type": "string"},
        "active_state": {"type": "string"},
        "sub_state": {"type": "string"},
        "restart_count": {"type": "integer"}
      }
    },
    "network_status": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "connected": {"type": "boolean"},
        "ssid": {"type": "string"},
        "ip_v4": {"type": "string"},
        "ip_v6": {"type": "string"}
      }
    },
    "audio_status": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "volume_percent": {"type": "integer"},
        "muted": {"type": "boolean"}
      }
    },
    "ingest_state": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "last_event_type": {"type": "string"},
        "last_event": {"type": "object"},
        "last_timestamp_ms": {"type": "integer", "minimum": 0}
      }
    },
    "vrx_state": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "selected": {"type": "integer"},
        "vrx": {"type": "array", "items": {"$ref": "#/$defs/vrx_item"}},
        "led": {"$ref": "#/$defs/led_state"},
        "sys": {"$ref": "#/$defs/vrx_sys"}
      }
    },
    "vrx_item": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "freq_hz", "rssi_raw"],
      "properties": {
        "id": {"type": "integer"},
        "freq_hz": {"type": "number"},
        "rssi_raw": {"type": "integer"}
      }
    },
    "led_state": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "r": {"type": "integer"},
        "y": {"type": "integer"},
        "g": {"type": "integer"}
      }
    },
    "vrx_sys": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "uptime_ms": {"type": "integer"},
        "heap": {"type": "integer"}
      }
    },
    "video_state": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "selected": {"type": "integer"}
      }
    },
    "replay_state": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "active": {"type": "boolean"},
        "source": {"type": "string"}
      }
    }
  }
}
